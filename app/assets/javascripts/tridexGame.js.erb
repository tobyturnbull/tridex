var game = new Phaser.Game(1257, 684, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload(){
  game.load.image('sky', '<%= image_path "sky.png" %>');
  game.load.spritesheet('player', '<%= image_path "player.png" %>', 43, 39);
  game.load.image('bullet', '<%= image_path "bullet.png" %>', 25, 11)
}

var background;
var player;
var bullets;
var cursors;
var fire;


function create(){
  bullets = game.add.group();

  game.physics.startSystem(Phaser.Physics.ARCADE);

  game.world.setBounds(0, 0, 1257, 684)

  player = game.add.sprite(50, 50, 'player');

  cursors = game.input.keyboard.createCursorKeys();

  game.physics.arcade.enable(player);
  game.physics.arcade.enable(bullets);
  // bullets.outOfBoundsKill = true;

  game.camera.follow(player);

  player.body.collideWorldBounds = true;

  // game.background.fixedToCamera = true

  // game.camera.follow(player);


}

function update(){

  var fire = function(){
    //  console.log(bullets);
    var b = bullets.create(player.body.x, player.body.y, 'bullet');
    game.physics.arcade.enable(b);
console.log(b);

  b.body.velocity.x = 300;
    //bullets.setAll('this.body.velocity.x', 300);
    // bullets.set(b, 'this.body.velocity.x', 300, true, true, 0, false);
    //bullets.body.velocity.x = 300;
  };

  player.body.velocity.x = 0;
  player.body.velocity.y = 0;

  if (cursors.up.isDown && cursors.left.isDown)
  {
    player.body.velocity.y = -300;
    player.body.velocity.x = -300;
    player.frame = 1;
  }
  else if (cursors.up.isDown && cursors.right.isDown)
  {
    player.body.velocity.y = -300;
    player.body.velocity.x = 300;
    player.frame = 7;
  }
  else if (cursors.down.isDown && cursors.left.isDown)
  {
    player.body.velocity.y = 300;
    player.body.velocity.x = -300;
    player.frame = 2;
  }
  else if (cursors.down.isDown && cursors.right.isDown)
  {
    player.body.velocity.y = 300;
    player.body.velocity.x = 300;
    player.frame = 8;
  }
  else if (cursors.left.isDown)
  {
    player.body.velocity.x = -300;

      // player.animations.play('left');
    player.frame = 0;
  }
  else if (cursors.right.isDown)
  {
    player.body.velocity.x = 300;
    player.frame = 6;
  }
  else if (cursors.up.isDown)
  {
    player.body.velocity.y = -200
    player.frame = 4;
    player.body.velocity.x = -50;
  }
  else if (cursors.down.isDown)
  {
    player.body.velocity.y = 200
    player.frame = 5;
    player.body.velocity.x = -50;
  }
  else
  {
    player.animations.stop();
    player.frame = 3;
    player.body.velocity.x = -50;

  }

  if (game.input.keyboard.isDown(Phaser.Keyboard.Z)) {
      fire();
  }

}

console.log("Test")